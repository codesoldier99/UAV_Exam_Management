# 📚 考试系统后端API详细接口说明书

## 🏠 项目概述

**项目名称**: 考试系统后端API  
**版本**: 1.0.0  
**GitHub仓库**: https://github.com/codesoldier99/UAVexam_site_backend.git  
**部署地址**: http://106.52.214.54/  
**最后更新**: 2025-08-04

这是一个功能完整的考试管理系统后端API，专为无人机驾驶员等各类技能考试管理而设计。系统支持机构管理、考生管理、排期管理、二维码签到、批量操作、权限控制等核心功能，并提供微信小程序接口支持。

## 🚀 快速开始

### 🔗 重要链接
- **Base URL**: `http://106.52.214.54/`
- **Swagger API文档**: `http://106.52.214.54/docs`
- **ReDoc文档**: `http://106.52.214.54/redoc`
- **本地开发**: `http://localhost:8000/`

### 🎯 技术栈
- **后端框架**: FastAPI
- **数据库**: PostgreSQL/MySQL
- **ORM**: SQLAlchemy
- **认证**: JWT Bearer Token
- **文档**: Swagger/OpenAPI 3.0
- **部署**: Docker + Docker Compose

### 📋 认证方式
所有需要认证的API都需要在请求头中包含Bearer Token：
```http
Authorization: Bearer <your_jwt_token>
```

### 📊 通用响应格式
```json
{
  "message": "操作描述信息",
  "data": {},
  "pagination": {
    "page": 1,
    "size": 10,
    "total": 100,
    "pages": 10
  },
  "timestamp": "2025-08-04T10:00:00Z"
}
```

### 🔧 通用查询参数
- `page`: 页码，默认1
- `size`: 每页数量，默认10，最大100
- `search`: 搜索关键词
- `status`: 状态筛选
- `start_date`: 开始日期
- `end_date`: 结束日期

---

## 📝 API接口详细说明

### 1. 🏠 系统基础接口

#### 1.1 根路径 - 系统欢迎信息
```http
GET /
```

**功能描述**: 获取系统基本信息和欢迎消息

**请求参数**: 无

**响应示例**:
```json
{
  "message": "欢迎使用考试系统后端API - 简化测试版本",
  "version": "1.0.0-test",
  "service": "考试管理系统",
  "timestamp": "2025-08-04T10:00:00Z"
}
```

**应用场景**: 系统连通性检查、版本信息获取

---

#### 1.2 健康检查 - 系统状态监控
```http
GET /health
```

**功能描述**: 检查系统健康状态，包括数据库连接、服务状态等

**请求参数**: 无

**响应示例**:
```json
{
  "status": "healthy",
  "timestamp": "2025-08-04T10:00:00Z",
  "version": "1.0.0",
  "service": "考试系统后端API",
  "components": {
    "database": "healthy",
    "cache": "healthy",
    "storage": "healthy"
  },
  "uptime": "2d 5h 30m"
}
```

**应用场景**: 运维监控、负载均衡健康检查

---

#### 1.3 测试接口 - API连通性验证
```http
GET /test
```

**功能描述**: 简单的连通性测试接口

**请求参数**: 无

**响应示例**:
```json
{
  "message": "测试成功",
  "status": "ok",
  "timestamp": "2025-08-04T10:00:00Z",
  "request_id": "req_12345",
  "server_info": {
    "hostname": "api-server-01",
    "environment": "production"
  }
}
```

**应用场景**: 网络连通性测试、API可用性验证

---

### 2. 🔐 认证授权接口

#### 2.1 用户登录
```http
POST /login
```

**功能描述**: 用户登录认证，获取访问令牌

**请求参数**:
```json
{
  "username": "admin",
  "password": "password123"
}
```

**响应示例**:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 3600,
  "user": {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com",
    "role": "admin",
    "status": "active",
    "last_login": "2025-08-04T10:00:00Z",
    "permissions": ["read", "write", "delete"]
  }
}
```

**错误响应**:
```json
{
  "detail": "用户名或密码错误",
  "error_code": "INVALID_CREDENTIALS",
  "timestamp": "2025-08-04T10:00:00Z"
}
```

**应用场景**: 系统登录、获取访问权限

---

#### 2.2 获取当前用户信息
```http
GET /me
```

**功能描述**: 获取当前登录用户的详细信息

**请求头**:
```http
Authorization: Bearer <token>
```

**响应示例**:
```json
{
  "id": 1,
  "username": "admin",
  "email": "admin@example.com",
  "role": "admin",
  "status": "active",
  "institution_id": null,
  "permissions": ["candidates:read", "candidates:write", "institutions:read"],
  "profile": {
    "name": "管理员",
    "phone": "13800138000",
    "avatar": "https://example.com/avatar.jpg"
  },
  "last_login": "2025-08-04T10:00:00Z",
  "created_at": "2025-01-01T00:00:00Z"
}
```

**应用场景**: 用户信息展示、权限验证

---

### 3. 🏢 机构管理接口

#### 3.1 获取机构列表
```http
GET /institutions
```

**功能描述**: 分页获取机构列表，支持搜索和筛选

**查询参数**:
- `page` (int): 页码，默认1
- `size` (int): 每页数量，默认10，最大100
- `status` (string): 状态筛选 (active/inactive)
- `search` (string): 搜索关键词（机构名称、联系人）
- `sort` (string): 排序字段 (name/created_at)
- `order` (string): 排序方向 (asc/desc)

**请求示例**:
```http
GET /institutions?page=1&size=20&status=active&search=航空&sort=created_at&order=desc
```

**响应示例**:
```json
{
  "message": "机构列表获取成功",
  "data": [
    {
      "id": 1,
      "name": "北京航空培训中心",
      "code": "BJHK001",
      "contact_person": "张经理",
      "phone": "010-12345678",
      "email": "contact@bjhk.com",
      "address": "北京市朝阳区航空路123号",
      "status": "active",
      "license_number": "L123456789",
      "business_scope": "无人机驾驶员培训",
      "stats": {
        "total_candidates": 156,
        "active_schedules": 8,
        "completed_exams": 89
      },
      "created_at": "2025-01-01T10:00:00Z",
      "updated_at": "2025-08-01T15:30:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 10,
    "total": 25,
    "pages": 3
  },
  "filters": {
    "status": "active",
    "search": "航空"
  }
}
```

**应用场景**: 机构管理列表页面、机构选择下拉框

---

#### 3.2 获取机构详情
```http
GET /institutions/{institution_id}
```

**功能描述**: 获取指定机构的详细信息

**路径参数**:
- `institution_id` (int): 机构ID

**响应示例**:
```json
{
  "message": "机构详情获取成功",
  "data": {
    "id": 1,
    "name": "北京航空培训中心",
    "code": "BJHK001",
    "contact_person": "张经理",
    "phone": "010-12345678",
    "email": "contact@bjhk.com",
    "address": "北京市朝阳区航空路123号",
    "description": "专业的无人机驾驶员培训机构",
    "status": "active",
    "license_number": "L123456789",
    "business_scope": "无人机驾驶员培训、航空器维修培训",
    "stats": {
      "total_candidates": 156,
      "active_schedules": 8,
      "completed_exams": 89,
      "pass_rate": 0.85,
      "monthly_growth": 0.12
    },
    "recent_activities": [
      {
        "date": "2025-08-01",
        "activity": "新增考生20人",
        "type": "candidate_registration"
      }
    ],
    "created_at": "2025-01-01T10:00:00Z",
    "updated_at": "2025-08-01T15:30:00Z"
  }
}
```

**错误响应** (404):
```json
{
  "detail": "机构不存在",
  "error_code": "INSTITUTION_NOT_FOUND",
  "institution_id": 999
}
```

**应用场景**: 机构详情页面、机构信息编辑

---

#### 3.3 创建机构
```http
POST /institutions
```

**功能描述**: 创建新的培训机构

**请求参数**:
```json
{
  "name": "上海航空学院",
  "code": "SHHK002",
  "contact_person": "李主任",
  "phone": "021-87654321",
  "email": "contact@shhk.edu.cn",
  "address": "上海市浦东新区航空路456号",
  "description": "专业航空培训机构",
  "license_number": "L987654321",
  "business_scope": "无人机驾驶员培训、飞行员培训"
}
```

**参数说明**:
- `name` (string, 必填): 机构名称，2-100字符
- `code` (string, 可选): 机构代码，唯一标识
- `contact_person` (string, 必填): 联系人姓名
- `phone` (string, 必填): 联系电话
- `email` (string, 可选): 联系邮箱
- `address` (string, 可选): 机构地址
- `license_number` (string, 可选): 许可证号码

**响应示例**:
```json
{
  "message": "机构创建成功",
  "data": {
    "id": 2,
    "name": "上海航空学院",
    "code": "SHHK002",
    "contact_person": "李主任",
    "phone": "021-87654321",
    "email": "contact@shhk.edu.cn",
    "status": "active",
    "created_at": "2025-08-04T10:00:00Z"
  }
}
```

**应用场景**: 新机构注册、系统管理员添加机构

---

#### 3.4 更新机构信息
```http
PUT /institutions/{institution_id}
```

**功能描述**: 更新指定机构的信息

**路径参数**:
- `institution_id` (int): 机构ID

**请求参数**:
```json
{
  "name": "北京航空培训中心（更新）",
  "contact_person": "王经理",
  "phone": "010-87654321",
  "email": "new_contact@bjhk.com",
  "address": "北京市朝阳区新航空路789号",
  "description": "专业的无人机培训机构，提供全方位培训服务"
}
```

**响应示例**:
```json
{
  "message": "机构信息更新成功",
  "data": {
    "id": 1,
    "name": "北京航空培训中心（更新）",
    "contact_person": "王经理",
    "phone": "010-87654321",
    "updated_at": "2025-08-04T10:00:00Z"
  }
}
```

**应用场景**: 机构信息维护、联系方式更新

---

#### 3.5 删除机构
```http
DELETE /institutions/{institution_id}
```

**功能描述**: 删除指定机构（软删除）

**路径参数**:
- `institution_id` (int): 机构ID

**响应示例**:
```json
{
  "message": "机构删除成功",
  "institution_id": 1,
  "deleted_at": "2025-08-04T10:00:00Z"
}
```

**注意事项**:
- 只有当机构下没有活跃的考生和排期时才能删除
- 执行软删除，数据仍保留在数据库中
- 需要管理员权限

**应用场景**: 机构注销、数据清理

---

### 4. 👨‍🎓 考生管理接口

#### 4.1 获取考生列表
```http
GET /candidates
```

**功能描述**: 分页获取考生列表，支持多条件筛选和搜索

**查询参数**:
- `page` (int): 页码，默认1
- `size` (int): 每页数量，默认10，最大100
- `status` (string): 状态筛选 (待排期/已审核/已考试/已通过/未通过)
- `exam_type` (string): 考试类型筛选
- `gender` (string): 性别筛选 (男/女)
- `institution_id` (int): 机构ID筛选
- `exam_product_id` (int): 考试产品ID筛选
- `search` (string): 搜索关键词（姓名、身份证、手机号）
- `start_date` (string): 注册开始日期
- `end_date` (string): 注册结束日期
- `sort` (string): 排序字段
- `order` (string): 排序方向

**请求示例**:
```http
GET /candidates?page=1&size=20&status=待排期&institution_id=1&search=张&sort=created_at&order=desc
```

**响应示例**:
```json
{
  "message": "考生列表获取成功",
  "data": [
    {
      "id": 1,
      "name": "张三",
      "id_number": "110101199001011234",
      "phone": "13800138001",
      "email": "zhangsan@example.com",
      "gender": "男",
      "birth_date": "1990-01-01",
      "address": "北京市朝阳区",
      "status": "待排期",
      "exam_product": {
        "id": 1,
        "name": "无人机驾驶员考试",
        "category": "理论+实操"
      },
      "institution": {
        "id": 1,
        "name": "北京航空培训中心"
      },
      "emergency_contact": "李四",
      "emergency_phone": "13900139000",
      "registration_date": "2025-08-01",
      "notes": "备注信息",
      "created_at": "2025-08-01T10:00:00Z",
      "updated_at": "2025-08-01T10:00:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 20,
    "total": 156,
    "pages": 8
  },
  "statistics": {
    "total_candidates": 156,
    "pending_schedule": 23,
    "scheduled": 45,
    "completed": 88
  }
}
```

**应用场景**: 考生管理页面、考生筛选查询

---

#### 4.2 获取考生详情
```http
GET /candidates/{candidate_id}
```

**功能描述**: 获取指定考生的详细信息，包括考试历史、排期信息等

**路径参数**:
- `candidate_id` (int): 考生ID

**响应示例**:
```json
{
  "message": "考生详情获取成功",
  "data": {
    "id": 1,
    "name": "张三",
    "id_number": "110101199001011234",
    "phone": "13800138001",
    "email": "zhangsan@example.com",
    "gender": "男",
    "birth_date": "1990-01-01",
    "address": "北京市朝阳区某某街道123号",
    "status": "已排期",
    "exam_product": {
      "id": 1,
      "name": "无人机驾驶员考试",
      "category": "理论+实操",
      "duration": 120
    },
    "institution": {
      "id": 1,
      "name": "北京航空培训中心",
      "contact_person": "张经理"
    },
    "emergency_contact": "李四",
    "emergency_phone": "13900139000",
    "schedules": [
      {
        "id": 1,
        "exam_date": "2025-08-10",
        "start_time": "09:00:00",
        "end_time": "11:00:00",
        "venue": "第一考场",
        "status": "已排期",
        "checkin_status": "未签到"
      }
    ],
    "exam_history": [
      {
        "date": "2025-07-15",
        "exam_type": "理论考试",
        "score": 85,
        "result": "通过"
      }
    ],
    "documents": [
      {
        "type": "身份证",
        "status": "已验证"
      },
      {
        "type": "培训证明",
        "status": "已提交"
      }
    ],
    "notes": "考生表现良好，准备充分",
    "created_at": "2025-08-01T10:00:00Z",
    "updated_at": "2025-08-01T15:30:00Z"
  }
}
```

**应用场景**: 考生详情页面、考生档案查看

---

#### 4.3 创建考生
```http
POST /candidates
```

**功能描述**: 创建新的考生记录

**请求参数**:
```json
{
  "name": "李四",
  "id_number": "110101199102011235",
  "phone": "13800138002",
  "email": "lisi@example.com",
  "gender": "女",
  "birth_date": "1991-02-01",
  "address": "北京市海淀区",
  "emergency_contact": "王五",
  "emergency_phone": "13900139001",
  "exam_product_id": 1,
  "institution_id": 1,
  "notes": "新学员，首次报考"
}
```

**参数说明**:
- `name` (string, 必填): 考生姓名，2-50字符
- `id_number` (string, 必填): 身份证号，18位
- `phone` (string, 必填): 手机号，11位
- `email` (string, 可选): 邮箱地址
- `gender` (string, 必填): 性别，男/女
- `birth_date` (string, 可选): 出生日期，YYYY-MM-DD格式
- `exam_product_id` (int, 必填): 考试产品ID
- `institution_id` (int, 必填): 所属机构ID

**响应示例**:
```json
{
  "message": "考生创建成功",
  "data": {
    "id": 2,
    "name": "李四",
    "id_number": "110101199102011235",
    "phone": "13800138002",
    "status": "待排期",
    "exam_product_name": "无人机驾驶员考试",
    "institution_name": "北京航空培训中心",
    "created_at": "2025-08-04T10:00:00Z"
  }
}
```

**错误响应** (400):
```json
{
  "detail": "身份证号已存在",
  "error_code": "DUPLICATE_ID_NUMBER",
  "field": "id_number",
  "value": "110101199102011235"
}
```

**应用场景**: 考生注册、批量导入考生

---

#### 4.4 更新考生信息
```http
PUT /candidates/{candidate_id}
```

**功能描述**: 更新指定考生的信息

**路径参数**:
- `candidate_id` (int): 考生ID

**请求参数**:
```json
{
  "name": "张三（更新）",
  "phone": "13800138888",
  "email": "zhangsan_new@example.com",
  "address": "北京市朝阳区新地址789号",
  "emergency_contact": "李四（更新）",
  "emergency_phone": "13900139999",
  "notes": "更新后的备注信息"
}
```

**响应示例**:
```json
{
  "message": "考生信息更新成功",
  "data": {
    "id": 1,
    "name": "张三（更新）",
    "phone": "13800138888",
    "updated_at": "2025-08-04T10:00:00Z"
  }
}
```

**应用场景**: 考生信息维护、联系方式更新

---

#### 4.5 删除考生
```http
DELETE /candidates/{candidate_id}
```

**功能描述**: 删除指定考生记录

**路径参数**:
- `candidate_id` (int): 考生ID

**响应示例** (204):
```json
{
  "message": "考生删除成功",
  "candidate_id": 1,
  "deleted_at": "2025-08-04T10:00:00Z"
}
```

**注意事项**:
- 只有在考生没有已排期的考试时才能删除
- 执行软删除，保留历史记录

**应用场景**: 考生信息清理、错误数据删除

---

### 5. 📝 考试产品管理接口

#### 5.1 获取考试产品列表
```http
GET /exam-products
```

**功能描述**: 获取所有可用的考试产品列表

**查询参数**:
- `page` (int): 页码，默认1
- `size` (int): 每页数量，默认20，最大100
- `category` (string): 考试类别筛选 (理论/实操/理论+实操)
- `status` (string): 状态筛选 (active/inactive)
- `difficulty` (string): 难度筛选 (简单/中等/困难)
- `search` (string): 搜索关键词

**响应示例**:
```json
{
  "message": "考试产品列表获取成功",
  "data": [
    {
      "id": 1,
      "name": "无人机驾驶员考试",
      "description": "民用无人机驾驶员资格考试",
      "code": "UAV_PILOT_001",
      "category": "理论+实操",
      "exam_type": "技能认证",
      "exam_class": "职业资格",
      "exam_level": "初级",
      "duration_minutes": 120,
      "theory_pass_score": 70,
      "practical_pass_score": 70,
      "training_hours": 60,
      "price": 500.00,
      "training_price": 2800.00,
      "difficulty": "中等",
      "status": "active",
      "requirements": [
        "年满18周岁",
        "具有初中以上文化程度",
        "无色盲色弱"
      ],
      "theory_content": "无人机基础知识、法规、气象学、飞行原理",
      "practical_content": "模拟飞行、实际操作、应急处置",
      "statistics": {
        "total_candidates": 256,
        "pass_rate": 0.78,
        "average_score": 82.5
      },
      "created_at": "2025-01-01T10:00:00Z",
      "updated_at": "2025-08-01T10:00:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 20,
    "total": 5,
    "pages": 1
  }
}
```

**应用场景**: 考试产品选择、产品管理页面

---

#### 5.2 获取考试产品详情
```http
GET /exam-products/{product_id}
```

**功能描述**: 获取指定考试产品的详细信息

**路径参数**:
- `product_id` (int): 考试产品ID

**响应示例**:
```json
{
  "message": "考试产品详情获取成功",
  "data": {
    "id": 1,
    "name": "无人机驾驶员考试",
    "description": "民用无人机驾驶员资格考试，包含理论和实操两部分",
    "code": "UAV_PILOT_001",
    "category": "理论+实操",
    "exam_type": "技能认证",
    "exam_class": "职业资格",
    "exam_level": "初级",
    "duration_minutes": 120,
    "theory_pass_score": 70,
    "practical_pass_score": 70,
    "training_hours": 60,
    "price": 500.00,
    "training_price": 2800.00,
    "difficulty": "中等",
    "status": "active",
    "syllabus": {
      "theory": [
        "无人机基础知识",
        "相关法律法规",
        "气象学基础",
        "飞行原理",
        "安全知识"
      ],
      "practical": [
        "模拟飞行训练",
        "实际操作考核",
        "应急处置演练",
        "设备检查维护"
      ]
    },
    "requirements": [
      "年满18周岁",
      "具有初中以上文化程度",
      "无色盲色弱",
      "身体健康"
    ],
    "exam_schedule": {
      "theory_time": 90,
      "practical_time": 30,
      "break_time": 15
    },
    "statistics": {
      "total_candidates": 256,
      "pass_rate": 0.78,
      "average_theory_score": 85.2,
      "average_practical_score": 79.8,
      "monthly_enrollment": 45
    },
    "created_at": "2025-01-01T10:00:00Z",
    "updated_at": "2025-08-01T10:00:00Z"
  }
}
```

**应用场景**: 考试产品详情页面、考生选择考试类型

---

### 6. 🏫 场地管理接口

#### 6.1 获取场地列表
```http
GET /venues
```

**功能描述**: 获取所有考试场地列表

**查询参数**:
- `page` (int): 页码，默认1
- `size` (int): 每页数量，默认20，最大100
- `type` (string): 场地类型筛选 (理论考场/实操考场/综合考场)
- `status` (string): 状态筛选 (active/inactive/maintenance)
- `search` (string): 搜索关键词

**响应示例**:
```json
{
  "message": "场地列表获取成功",
  "data": [
    {
      "id": 1,
      "name": "第一理论考场",
      "type": "理论考场",
      "location": "教学楼A座201",
      "capacity": 50,
      "status": "active",
      "equipment": [
        "投影仪",
        "音响设备",
        "空调",
        "监控设备"
      ],
      "current_usage": {
        "is_occupied": false,
        "current_exam": null,
        "next_exam": {
          "exam_name": "无人机驾驶员考试",
          "start_time": "2025-08-05T09:00:00Z",
          "candidate_count": 25
        }
      },
      "maintenance_record": {
        "last_maintenance": "2025-07-15",
        "next_maintenance": "2025-09-15",
        "status": "良好"
      },
      "created_at": "2025-01-01T10:00:00Z",
      "updated_at": "2025-08-01T10:00:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 20,
    "total": 8,
    "pages": 1
  }
}
```

**应用场景**: 场地管理、考试排期安排

---

#### 6.2 获取场地详情
```http
GET /venues/{venue_id}
```

**功能描述**: 获取指定场地的详细信息

**路径参数**:
- `venue_id` (int): 场地ID

**响应示例**:
```json
{
  "message": "场地详情获取成功",
  "data": {
    "id": 1,
    "name": "第一理论考场",
    "type": "理论考场",
    "location": "教学楼A座201",
    "capacity": 50,
    "area": 120.5,
    "status": "active",
    "description": "设备齐全的理论考试场地，适合各类笔试考试",
    "equipment": [
      {
        "name": "投影仪",
        "model": "Epson EB-X41",
        "status": "正常"
      },
      {
        "name": "音响设备",
        "model": "BOSE SoundTouch",
        "status": "正常"
      }
    ],
    "layout": {
      "rows": 10,
      "seats_per_row": 5,
      "total_seats": 50
    },
    "schedule_today": [
      {
        "time": "09:00-11:00",
        "exam": "无人机驾驶员考试",
        "candidates": 25,
        "status": "scheduled"
      },
      {
        "time": "14:00-16:00",
        "exam": "计算机等级考试",
        "candidates": 30,
        "status": "scheduled"
      }
    ],
    "utilization": {
      "this_week": 0.75,
      "this_month": 0.68,
      "average_candidates_per_session": 28
    },
    "maintenance_record": [
      {
        "date": "2025-07-15",
        "type": "定期保养",
        "description": "设备检查，环境清洁",
        "cost": 500.00
      }
    ],
    "created_at": "2025-01-01T10:00:00Z",
    "updated_at": "2025-08-01T10:00:00Z"
  }
}
```

**应用场景**: 场地详情页面、设备管理、维护记录

---

### 7. 📅 排期管理接口

#### 7.1 获取排期列表
```http
GET /schedules
```

**功能描述**: 获取考试排期列表，支持多条件筛选

**查询参数**:
- `page` (int): 页码，默认1
- `size` (int): 每页数量，默认10，最大100
- `candidate_id` (int): 考生ID筛选
- `venue_id` (int): 场地ID筛选
- `exam_product_id` (int): 考试产品ID筛选
- `status` (string): 状态筛选 (scheduled/completed/cancelled)
- `exam_date` (string): 考试日期筛选
- `start_date` (string): 开始日期范围
- `end_date` (string): 结束日期范围

**响应示例**:
```json
{
  "message": "排期列表获取成功",
  "data": [
    {
      "id": 1,
      "candidate": {
        "id": 1,
        "name": "张三",
        "phone": "13800138001"
      },
      "exam_product": {
        "id": 1,
        "name": "无人机驾驶员考试",
        "category": "理论+实操"
      },
      "venue": {
        "id": 1,
        "name": "第一理论考场",
        "type": "理论考场"
      },
      "exam_date": "2025-08-10",
      "start_time": "09:00:00",
      "end_time": "11:00:00",
      "schedule_type": "theory",
      "status": "scheduled",
      "checkin_status": "未签到",
      "seat_number": "A01",
      "notes": "上午理论考试",
      "qr_code": "schedule_1_20250810",
      "created_at": "2025-08-01T10:00:00Z",
      "updated_at": "2025-08-01T10:00:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 10,
    "total": 156,
    "pages": 16
  },
  "statistics": {
    "total_schedules": 156,
    "scheduled": 89,
    "completed": 45,
    "cancelled": 12,
    "checked_in": 67
  }
}
```

**应用场景**: 排期管理页面、考试安排查询

---

#### 7.2 批量创建排期
```http
POST /schedules/batch-create
```

**功能描述**: 批量创建考试排期

**请求参数**:
```json
{
  "exam_date": "2025-08-15",
  "start_time": "09:00:00",
  "end_time": "11:00:00",
  "venue_id": 1,
  "exam_product_id": 1,
  "schedule_type": "theory",
  "candidate_ids": [1, 2, 3, 4, 5],
  "notes": "第一批理论考试",
  "auto_assign_seats": true
}
```

**参数说明**:
- `exam_date` (string, 必填): 考试日期，YYYY-MM-DD格式
- `start_time` (string, 必填): 开始时间，HH:MM:SS格式
- `end_time` (string, 必填): 结束时间，HH:MM:SS格式
- `venue_id` (int, 必填): 场地ID
- `exam_product_id` (int, 必填): 考试产品ID
- `candidate_ids` (array, 必填): 考生ID列表
- `auto_assign_seats` (bool): 是否自动分配座位

**响应示例**:
```json
{
  "message": "批量排期创建成功",
  "result": {
    "total_requested": 5,
    "success_count": 5,
    "failed_count": 0,
    "schedules": [
      {
        "id": 10,
        "candidate_id": 1,
        "candidate_name": "张三",
        "seat_number": "A01",
        "qr_code": "schedule_10_20250815"
      },
      {
        "id": 11,
        "candidate_id": 2,
        "candidate_name": "李四",
        "seat_number": "A02",
        "qr_code": "schedule_11_20250815"
      }
    ],
    "failed_items": [],
    "venue_info": {
      "name": "第一理论考场",
      "remaining_capacity": 45
    }
  }
}
```

**应用场景**: 批量排期安排、考试组织

---

#### 7.3 更新排期
```http
PUT /schedules/{schedule_id}
```

**功能描述**: 更新指定排期的信息

**路径参数**:
- `schedule_id` (int): 排期ID

**请求参数**:
```json
{
  "exam_date": "2025-08-12",
  "start_time": "14:00:00",
  "end_time": "16:00:00",
  "venue_id": 2,
  "seat_number": "B05",
  "notes": "调整到下午场次"
}
```

**响应示例**:
```json
{
  "message": "排期更新成功",
  "data": {
    "id": 1,
    "exam_date": "2025-08-12",
    "start_time": "14:00:00",
    "end_time": "16:00:00",
    "venue_name": "第二理论考场",
    "seat_number": "B05",
    "updated_at": "2025-08-04T10:00:00Z"
  }
}
```

**应用场景**: 排期调整、时间变更、场地更换

---

### 8. 📱 二维码签到接口

#### 8.1 生成考试二维码
```http
GET /qrcode/generate-schedule-qr/{schedule_id}
```

**功能描述**: 为指定排期生成签到二维码

**路径参数**:
- `schedule_id` (int): 排期ID

**响应示例**:
```json
{
  "message": "考试排期二维码生成成功",
  "data": {
    "schedule_id": 1,
    "qr_content": "schedule_checkin_1_20250810_09001100",
    "qr_url": "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=schedule_checkin_1_20250810_09001100",
    "qr_data": {
      "type": "schedule_checkin",
      "schedule_id": 1,
      "exam_date": "2025-08-10",
      "start_time": "09:00:00",
      "venue": "第一理论考场",
      "timestamp": "2025-08-04T10:00:00Z",
      "valid_until": "2025-08-10T11:00:00Z"
    },
    "scan_instructions": "考生请在考试开始前30分钟扫描此二维码进行签到",
    "validity": {
      "valid_from": "2025-08-10T08:30:00Z",
      "valid_until": "2025-08-10T11:00:00Z",
      "timezone": "Asia/Shanghai"
    }
  }
}
```

**应用场景**: 考试签到准备、二维码打印、考务管理

---

#### 8.2 扫码签到
```http
POST /qrcode/scan-checkin
```

**功能描述**: 通过扫描二维码进行考生签到

**请求参数**:
```json
{
  "qr_content": "schedule_checkin_1_20250810_09001100",
  "staff_id": 1,
  "checkin_location": "考场入口",
  "notes": "正常签到"
}
```

**参数说明**:
- `qr_content` (string, 必填): 扫描的二维码内容
- `staff_id` (int, 可选): 考务人员ID
- `checkin_location` (string, 可选): 签到地点
- `notes` (string, 可选): 签到备注

**响应示例**:
```json
{
  "message": "签到成功",
  "data": {
    "checkin_id": 1,
    "schedule": {
      "id": 1,
      "exam_date": "2025-08-10",
      "start_time": "09:00:00",
      "venue": "第一理论考场"
    },
    "candidate": {
      "id": 1,
      "name": "张三",
      "id_number": "110101199001011234",
      "seat_number": "A01"
    },
    "checkin_info": {
      "checkin_time": "2025-08-10T08:45:00Z",
      "status": "已签到",
      "early_minutes": 15,
      "staff_name": "王老师"
    },
    "next_steps": [
      "请前往座位A01就座",
      "考试将在09:00准时开始",
      "请准备好身份证和准考证"
    ]
  }
}
```

**错误响应** (400):
```json
{
  "detail": "二维码已过期或无效",
  "error_code": "INVALID_QR_CODE",
  "qr_content": "schedule_checkin_1_20250810_09001100",
  "valid_until": "2025-08-10T11:00:00Z"
}
```

**应用场景**: 考生签到、考勤管理、身份验证

---

#### 8.3 签到状态查询
```http
GET /qrcode/checkin-status/{schedule_id}
```

**功能描述**: 查询指定排期的签到状态

**路径参数**:
- `schedule_id` (int): 排期ID

**响应示例**:
```json
{
  "message": "签到状态查询成功",
  "data": {
    "schedule": {
      "id": 1,
      "exam_date": "2025-08-10",
      "start_time": "09:00:00",
      "venue": "第一理论考场",
      "total_candidates": 25
    },
    "checkin_status": {
      "checked_in": 23,
      "not_checked_in": 2,
      "checkin_rate": 0.92,
      "last_checkin_time": "2025-08-10T08:55:00Z"
    },
    "checkin_details": [
      {
        "candidate_id": 1,
        "candidate_name": "张三",
        "seat_number": "A01",
        "checkin_time": "2025-08-10T08:45:00Z",
        "status": "已签到"
      },
      {
        "candidate_id": 2,
        "candidate_name": "李四",
        "seat_number": "A02",
        "checkin_time": null,
        "status": "未签到"
      }
    ],
    "statistics": {
      "earliest_checkin": "2025-08-10T08:30:00Z",
      "latest_checkin": "2025-08-10T08:55:00Z",
      "average_early_minutes": 12
    }
  }
}
```

**应用场景**: 考务管理、签到统计、考试组织

---

### 9. 📊 批量操作接口

#### 9.1 下载考生导入模板
```http
GET /batch/candidates/template
```

**功能描述**: 下载Excel格式的考生批量导入模板

**响应**: Excel文件下载

**模板包含字段**:
- 考生姓名 (必填)
- 身份证号 (必填)
- 联系电话 (必填)
- 邮箱地址 (可选)
- 性别 (必填: 男/女)
- 出生日期 (可选: YYYY-MM-DD)
- 地址 (可选)
- 紧急联系人 (可选)
- 紧急联系电话 (可选)
- 考试产品名称 (必填)
- 机构名称 (必填)
- 备注 (可选)

**应用场景**: 批量数据准备、Excel模板下载

---

#### 9.2 批量导入考生
```http
POST /batch/candidates/import
```

**功能描述**: 通过Excel文件批量导入考生数据

**请求参数**:
- `file` (file): Excel文件
- `institution_id` (int): 默认机构ID（可选）
- `exam_product_id` (int): 默认考试产品ID（可选）
- `skip_duplicates` (bool): 是否跳过重复数据

**响应示例**:
```json
{
  "message": "批量导入考生完成",
  "result": {
    "total_rows": 50,
    "processed_rows": 48,
    "success_count": 45,
    "failed_count": 3,
    "skipped_count": 2,
    "success_items": [
      {
        "row": 2,
        "name": "张三",
        "id_number": "110101199001011234",
        "candidate_id": 101,
        "status": "创建成功"
      },
      {
        "row": 3,
        "name": "李四",
        "id_number": "110101199102011235",
        "candidate_id": 102,
        "status": "创建成功"
      }
    ],
    "failed_items": [
      {
        "row": 10,
        "name": "王五",
        "id_number": "invalid_id",
        "error": "身份证号格式错误",
        "error_code": "INVALID_ID_FORMAT"
      }
    ],
    "skipped_items": [
      {
        "row": 15,
        "name": "赵六",
        "id_number": "110101199001011234",
        "reason": "身份证号重复",
        "existing_candidate_id": 50
      }
    ],
    "import_summary": {
      "import_time": "2025-08-04T10:00:00Z",
      "import_user": "admin",
      "file_name": "candidates_20250804.xlsx",
      "processing_time": "00:02:15"
    }
  }
}
```

**错误响应** (400):
```json
{
  "detail": "文件格式错误或为空",
  "error_code": "INVALID_FILE_FORMAT",
  "supported_formats": [".xlsx", ".xls"]
}
```

**应用场景**: 批量考生注册、数据迁移、Excel数据导入

---

#### 9.3 批量排期
```http
POST /batch/schedules
```

**功能描述**: 批量创建考试排期

**请求参数**:
```json
{
  "exam_date": "2025-08-15",
  "start_time": "09:00:00",
  "venue_id": 1,
  "exam_product_id": 1,
  "duration_minutes": 120,
  "candidate_ids": [1, 2, 3, 4, 5],
  "schedule_type": "theory",
  "auto_assign_seats": true,
  "break_time_minutes": 15,
  "notes": "第一批次考试"
}
```

**响应示例**:
```json
{
  "message": "批量排期创建成功",
  "result": {
    "total_candidates": 5,
    "success_count": 5,
    "failed_count": 0,
    "schedules": [
      {
        "schedule_id": 20,
        "candidate_id": 1,
        "candidate_name": "张三",
        "start_time": "09:00:00",
        "end_time": "11:00:00",
        "seat_number": "A01"
      }
    ],
    "venue_info": {
      "venue_name": "第一理论考场",
      "total_capacity": 50,
      "used_capacity": 5,
      "remaining_capacity": 45
    },
    "time_slots": {
      "theory_session": {
        "start": "09:00:00",
        "end": "10:30:00"
      },
      "break": {
        "start": "10:30:00",
        "end": "10:45:00"
      },
      "practical_session": {
        "start": "10:45:00",
        "end": "11:00:00"
      }
    }
  }
}
```

**应用场景**: 批量考试安排、考期组织、排期管理

---

### 10. 👨‍💼 用户权限管理接口

#### 10.1 获取用户列表
```http
GET /users
```

**功能描述**: 获取系统用户列表，支持角色和状态筛选

**查询参数**:
- `page` (int): 页码，默认1
- `size` (int): 每页数量，默认10，最大100
- `role` (string): 角色筛选 (admin/examiner/student/teacher)
- `status` (string): 状态筛选 (active/inactive)
- `institution_id` (int): 机构ID筛选
- `search` (string): 搜索关键词

**响应示例**:
```json
{
  "message": "用户列表获取成功",
  "data": [
    {
      "id": 1,
      "username": "admin",
      "email": "admin@example.com",
      "role": "admin",
      "status": "active",
      "institution": {
        "id": null,
        "name": null
      },
      "profile": {
        "name": "系统管理员",
        "phone": "13800138000",
        "department": "技术部"
      },
      "permissions": [
        "users:read",
        "users:write",
        "candidates:read",
        "candidates:write",
        "schedules:read",
        "schedules:write"
      ],
      "last_login": "2025-08-04T09:30:00Z",
      "created_at": "2025-01-01T00:00:00Z",
      "updated_at": "2025-08-04T09:30:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 10,
    "total": 25,
    "pages": 3
  },
  "role_statistics": {
    "admin": 2,
    "examiner": 8,
    "teacher": 12,
    "student": 3
  }
}
```

**应用场景**: 用户管理、权限分配、系统管理

---

#### 10.2 创建用户
```http
POST /users
```

**功能描述**: 创建新的系统用户

**请求参数**:
```json
{
  "username": "teacher01",
  "email": "teacher01@example.com",
  "password": "SecurePass123!",
  "role": "teacher",
  "institution_id": 1,
  "profile": {
    "name": "张老师",
    "phone": "13900139000",
    "department": "教学部"
  },
  "permissions": [
    "candidates:read",
    "schedules:read",
    "schedules:write"
  ]
}
```

**响应示例**:
```json
{
  "message": "用户创建成功",
  "data": {
    "id": 26,
    "username": "teacher01",
    "email": "teacher01@example.com",
    "role": "teacher",
    "status": "active",
    "institution_name": "北京航空培训中心",
    "created_at": "2025-08-04T10:00:00Z"
  }
}
```

**应用场景**: 用户注册、系统管理、权限分配

---

### 11. 🔄 实时功能接口

#### 11.1 实时状态查询
```http
GET /realtime/status
```

**功能描述**: 获取系统实时状态信息

**响应示例**:
```json
{
  "message": "实时状态获取成功",
  "data": {
    "timestamp": "2025-08-04T10:00:00Z",
    "system_status": {
      "status": "healthy",
      "active_users": 25,
      "active_sessions": 18,
      "database_connections": 12
    },
    "exam_status": {
      "ongoing_exams": 3,
      "today_schedules": 45,
      "checked_in_candidates": 32,
      "pending_checkins": 13
    },
    "venue_status": [
      {
        "venue_id": 1,
        "name": "第一理论考场",
        "status": "occupied",
        "current_exam": "无人机驾驶员考试",
        "candidate_count": 25,
        "remaining_time": 45
      }
    ],
    "notifications": [
      {
        "id": 1,
        "type": "warning",
        "message": "第二考场空调故障，请及时维修",
        "created_at": "2025-08-04T09:45:00Z"
      }
    ]
  }
}
```

**应用场景**: 实时监控、运营状态、决策支持

---

#### 11.2 WebSocket连接
```http
WS /realtime/ws/{user_id}
```

**功能描述**: 建立WebSocket连接，接收实时推送

**连接参数**:
- `user_id` (int): 用户ID
- `token` (string): 认证令牌 (通过查询参数传递)

**消息格式**:
```json
{
  "type": "checkin_update",
  "data": {
    "schedule_id": 1,
    "candidate_name": "张三",
    "checkin_time": "2025-08-04T08:45:00Z",
    "status": "checked_in"
  },
  "timestamp": "2025-08-04T08:45:00Z"
}
```

**消息类型**:
- `checkin_update`: 签到状态更新
- `schedule_change`: 排期变更
- `system_notification`: 系统通知
- `venue_status_change`: 场地状态变更

**应用场景**: 实时通信、状态推送、消息通知

---

### 12. 📱 微信小程序接口

#### 12.1 考生信息查询
```http
GET /wx-miniprogram/candidate-info
```

**功能描述**: 通过身份证号查询考生信息

**查询参数**:
- `id_number` (string): 身份证号

**响应示例**:
```json
{
  "message": "考生信息查询成功",
  "data": {
    "candidate": {
      "id": 1,
      "name": "张三",
      "phone": "13800138001",
      "status": "已排期",
      "exam_product": "无人机驾驶员考试",
      "institution": "北京航空培训中心",
      "registration_date": "2025-08-01"
    },
    "schedules": [
      {
        "id": 1,
        "exam_date": "2025-08-10",
        "start_time": "09:00:00",
        "venue": "第一理论考场",
        "seat_number": "A01",
        "status": "已排期",
        "checkin_status": "未签到"
      }
    ],
    "exam_tips": [
      "请提前30分钟到达考场",
      "请携带身份证原件",
      "考试期间请保持安静"
    ]
  }
}
```

**应用场景**: 微信小程序、考生自助查询、移动端服务

---

#### 12.2 考试安排查询
```http
GET /wx-miniprogram/exam-schedule
```

**功能描述**: 查询考生的考试安排

**查询参数**:
- `id_number` (string): 身份证号
- `phone` (string): 手机号

**响应示例**:
```json
{
  "message": "考试安排查询成功",
  "data": {
    "candidate_name": "张三",
    "upcoming_exams": [
      {
        "schedule_id": 1,
        "exam_date": "2025-08-10",
        "start_time": "09:00:00",
        "end_time": "11:00:00",
        "exam_type": "理论考试",
        "venue": "第一理论考场",
        "address": "教学楼A座201",
        "seat_number": "A01",
        "checkin_start_time": "08:30:00",
        "preparation_items": [
          "身份证原件",
          "准考证",
          "2B铅笔",
          "橡皮擦"
        ]
      }
    ],
    "exam_history": [
      {
        "exam_date": "2025-07-15",
        "exam_type": "模拟考试",
        "score": 85,
        "result": "通过"
      }
    ],
    "notifications": [
      "请确认考试时间和地点",
      "如有疑问请联系培训机构"
    ]
  }
}
```

**应用场景**: 微信小程序、考试提醒、移动查询

---

## 🚨 错误码说明

### HTTP状态码
| 状态码 | 说明 | 应用场景 |
|--------|------|----------|
| 200 | 请求成功 | 正常响应 |
| 201 | 创建成功 | 资源创建 |
| 204 | 删除成功，无返回内容 | 删除操作 |
| 400 | 请求参数错误 | 参数验证失败 |
| 401 | 未授权，需要登录 | 认证失败 |
| 403 | 权限不足 | 权限验证失败 |
| 404 | 资源不存在 | 资源未找到 |
| 409 | 数据冲突 | 重复数据 |
| 422 | 请求参数验证失败 | 业务逻辑验证失败 |
| 500 | 服务器内部错误 | 系统异常 |

### 业务错误码
| 错误码 | 说明 | 解决方案 |
|--------|------|----------|
| INVALID_CREDENTIALS | 用户名或密码错误 | 检查登录信息 |
| TOKEN_EXPIRED | 访问令牌已过期 | 重新登录获取令牌 |
| INSUFFICIENT_PERMISSIONS | 权限不足 | 联系管理员分配权限 |
| DUPLICATE_ID_NUMBER | 身份证号已存在 | 检查身份证号是否重复 |
| INVALID_ID_FORMAT | 身份证号格式错误 | 检查身份证号格式 |
| CANDIDATE_NOT_FOUND | 考生不存在 | 检查考生ID |
| INSTITUTION_NOT_FOUND | 机构不存在 | 检查机构ID |
| VENUE_OCCUPIED | 场地已被占用 | 选择其他时间或场地 |
| SCHEDULE_CONFLICT | 排期时间冲突 | 调整排期时间 |
| INVALID_QR_CODE | 二维码无效或已过期 | 重新生成二维码 |
| FILE_FORMAT_ERROR | 文件格式错误 | 上传正确格式的文件 |

---

## 🛠️ 部署指南

### 环境要求
- **Python**: 3.8+
- **数据库**: PostgreSQL 12+ / MySQL 8.0+
- **Redis**: 6.0+ (可选，用于缓存)
- **Docker**: 20.0+ (可选)

### 本地开发环境
```bash
# 1. 克隆代码
git clone https://github.com/codesoldier99/UAVexam_site_backend.git
cd exam_site_backend

# 2. 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
# 或
venv\Scripts\activate  # Windows

# 3. 安装依赖
pip install -r requirements.txt

# 4. 配置环境变量
cp env.example .env
# 编辑 .env 文件配置数据库等信息

# 5. 数据库迁移
alembic upgrade head

# 6. 启动服务
python start_server.py
```

### Docker部署
```bash
# 1. 构建镜像
docker-compose build

# 2. 启动服务
docker-compose up -d

# 3. 查看日志
docker-compose logs -f api

# 4. 停止服务
docker-compose down
```

### 生产环境部署
```bash
# 1. 使用生产配置
docker-compose -f docker-compose.prod.yml up -d

# 2. 配置反向代理 (Nginx)
# 参考 nginx/nginx.conf 配置文件

# 3. SSL证书配置
# 使用 Let's Encrypt 或其他证书

# 4. 监控和日志
# 配置日志收集和监控系统
```

### 环境变量配置
```bash
# 数据库配置
DATABASE_URL=postgresql://user:password@localhost/exam_db
DB_HOST=localhost
DB_PORT=5432
DB_NAME=exam_db
DB_USER=exam_user
DB_PASSWORD=secure_password

# 应用配置
SECRET_KEY=your-super-secret-key-here
DEBUG=False
CORS_ORIGINS=["http://localhost:3000", "https://yourdomain.com"]

# JWT配置
JWT_SECRET_KEY=jwt-secret-key
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=60
JWT_REFRESH_TOKEN_EXPIRE_DAYS=30

# Redis配置 (可选)
REDIS_URL=redis://localhost:6379/0

# 文件存储配置
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=10485760  # 10MB

# 邮件配置 (可选)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password

# 微信小程序配置 (可选)
WECHAT_APP_ID=your-wechat-app-id
WECHAT_APP_SECRET=your-wechat-app-secret
```

---

## 🧪 测试说明

### 测试文件说明
- `api_full_test.py`: 完整API测试套件
- `test_core_features.py`: 核心功能测试
- `comprehensive_api_test.py`: 综合API测试
- `api_status_check.py`: API状态检查
- `quick_api_test.py`: 快速API测试

### 运行测试
```bash
# 完整测试
python api_full_test.py

# 核心功能测试
python test_core_features.py

# 状态检查
python api_status_check.py

# 使用pytest运行测试
pytest src/tests/ -v

# 生成测试报告
pytest src/tests/ --html=report.html
```

### 测试覆盖率
```bash
# 安装覆盖率工具
pip install pytest-cov

# 运行覆盖率测试
pytest src/tests/ --cov=src --cov-report=html

# 查看覆盖率报告
open htmlcov/index.html
```

### API测试示例
```python
import requests
import json

# 基础URL
BASE_URL = "http://localhost:8000"

# 测试登录
def test_login():
    url = f"{BASE_URL}/login"
    data = {
        "username": "admin",
        "password": "password"
    }
    response = requests.post(url, json=data)
    assert response.status_code == 200
    return response.json()["access_token"]

# 测试获取考生列表
def test_get_candidates():
    token = test_login()
    url = f"{BASE_URL}/candidates"
    headers = {"Authorization": f"Bearer {token}"}
    response = requests.get(url, headers=headers)
    assert response.status_code == 200
    print(f"获取到 {len(response.json()['data'])} 个考生")

if __name__ == "__main__":
    test_get_candidates()
```

---

## 📊 性能优化建议

### 数据库优化
1. **索引优化**
   ```sql
   -- 考生表索引
   CREATE INDEX idx_candidates_id_number ON candidates(id_number);
   CREATE INDEX idx_candidates_phone ON candidates(phone);
   CREATE INDEX idx_candidates_institution ON candidates(institution_id);
   
   -- 排期表索引
   CREATE INDEX idx_schedules_date ON schedules(exam_date);
   CREATE INDEX idx_schedules_venue ON schedules(venue_id);
   CREATE INDEX idx_schedules_candidate ON schedules(candidate_id);
   ```

2. **查询优化**
   - 使用分页查询避免大数据量返回
   - 适当使用缓存减少数据库压力
   - 优化复杂查询，避免N+1问题

### 接口性能
1. **响应时间优化**
   - 接口响应时间控制在200ms以内
   - 复杂查询使用异步处理
   - 大文件上传使用分片上传

2. **并发处理**
   - 使用连接池管理数据库连接
   - 适当的线程池配置
   - 实现请求限流和熔断机制

### 缓存策略
1. **Redis缓存**
   ```python
   # 缓存用户信息
   cache_key = f"user:{user_id}"
   cache_time = 3600  # 1小时
   
   # 缓存考试产品列表
   cache_key = "exam_products:list"
   cache_time = 1800  # 30分钟
   ```

2. **应用缓存**
   - 静态数据缓存（考试产品、场地信息）
   - 用户权限缓存
   - 配置信息缓存

---

## 🔐 安全说明

### 认证安全
1. **JWT Token安全**
   - 使用强密钥生成Token
   - 设置合理的过期时间
   - 实现Token刷新机制

2. **密码安全**
   - 使用bcrypt等强加密算法
   - 实现密码复杂度要求
   - 登录失败次数限制

### 数据安全
1. **敏感数据保护**
   - 身份证号部分脱敏显示
   - 手机号中间位数隐藏
   - 重要操作日志记录

2. **输入验证**
   - 所有用户输入进行验证
   - SQL注入防护
   - XSS攻击防护

### 接口安全
1. **访问控制**
   - 基于角色的权限控制
   - 接口级别的权限验证
   - 敏感操作二次确认

2. **请求安全**
   - 请求频率限制
   - IP白名单机制
   - 接口访问日志

---

## 📞 技术支持

### 联系方式
- **GitHub Issues**: https://github.com/codesoldier99/UAVexam_site_backend/issues
- **邮箱支持**: 技术支持邮箱
- **文档地址**: API在线文档地址

### 常见问题

#### Q1: 如何获取访问令牌？
A1: 通过 `/login` 接口使用用户名和密码登录获取 `access_token`。

#### Q2: 令牌过期怎么办？
A2: 需要重新调用登录接口获取新的令牌，或使用刷新令牌机制。

#### Q3: 如何批量导入考生？
A3: 先下载模板文件，填写考生信息后通过 `/batch/candidates/import` 接口上传。

#### Q4: 二维码签到不成功？
A4: 检查二维码是否在有效期内，确认考试时间是否正确。

#### Q5: 如何修改排期时间？
A5: 使用 `PUT /schedules/{schedule_id}` 接口更新排期信息。

### 更新日志

#### v1.0.0 (2025-08-04)
- ✅ 完整的API接口实现
- ✅ 机构管理功能
- ✅ 考生管理功能
- ✅ 排期管理功能
- ✅ 二维码签到功能
- ✅ 批量操作功能
- ✅ 权限管理系统
- ✅ 微信小程序接口
- ✅ 实时通信功能
- ✅ 完整的测试套件
- ✅ Docker部署支持

---

## 📋 附录

### 数据库表结构
详细的数据库表结构请参考项目中的 `alembic/versions/` 目录下的迁移文件。

### Postman集合
项目根目录下的 `exam_site_backend.postman_collection.json` 文件包含了所有API接口的Postman测试集合。

### 开发规范
- **代码风格**: 遵循PEP 8规范
- **命名规范**: 使用snake_case命名
- **注释规范**: 重要函数添加docstring
- **版本控制**: 使用Git进行版本管理

---

*本文档最后更新: 2025-08-04 10:00:00*  
*文档版本: v1.0.0*